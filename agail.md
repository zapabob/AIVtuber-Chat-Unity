要件定義書（リライト版）
1. 概要
目的・ビジョン:

本アプリは、AIVtuberとして振る舞うVRMアバターとユーザが対話を楽しめるチャットアプリ。
チャット時のLLM推論はDify API経由で行い、オンライン環境で外部サービスを利用するほか、ローカルに配置したggufフォーマットのLLMモデルを、Dify API経由のローカルモードとして動作させることも可能。
対応OSはWindowsおよびmacOSを初期ターゲットとし、Android向けサポートは将来の追加実装計画として考慮する。
ユーザは直感的なUIでアバター選択、背景変更、チャットフォームカスタマイズなどを行える。
2. 対象プラットフォーム・環境
対応OS (初期リリース):

Windows 10以降
macOS 10.15以降
将来対応計画:

Android 10以降へのポーティングを中長期的な目標とする（追加実装計画に含む）
開発環境:

Unity 2022 LTS (URP想定)
C# (Unity標準Runtime)
Gitでソース管理
VRMハンドリングにはUniVRMパッケージを利用
3. 機能要件
3.1 チャット機能
ユーザはテキスト入力フィールドと送信ボタンでAIVtuberへ話しかける。
入力テキストはDify APIを介してLLMに問い合わせ、自然言語応答を取得する。
「オンラインモード」：Dify API経由で外部LLMを呼び出し
「ローカルモード」：ローカルに配置したgguf形式のLLMモデルをDify API経由で参照し、外部サービス非依存で応答生成
得られたレスポンスはチャットウィンドウに表示され、同時にアバターがリップシンクを行う。
会話ログをローカルに保存（JSON形式など）し、過去ログ参照機能を実装。
3.2 VRMアバター表示・制御
ユーザはアプリ内UIからローカルフォルダより任意のVRMファイルを選択し、アバターとして読み込む。
VRMアバターはリップシンク、表情制御、アイドルモーションなどで自然なアニメーションを行う。
会話内容に応じた簡易的な表情変化（キーワード解析による感情推定）を実装。
3.3 UIカスタマイズ
チャットウィンドウ、背景、BGM、フォント、テーマカラーなどをUIから直感的に設定可能。
設定内容はローカルに保存し、次回起動時に復元する。
3.4 Dify API＆ローカルLLM (gguf) 統合
Dify APIを経由して外部LLMまたはローカルのggufモデルを利用。
「オンラインモード」：インターネット接続がある場合、Dify APIを介して外部LLMへ問い合わせ。
「ローカルモード」：Dify APIはローカル実行も想定（例えばDifyのローカルサーバ設定）、ggufモデルをローカルでロードしてAPIを介した問い合わせが可能。
各モードは設定画面でユーザが選択できる。
LLMパラメータ（temperature、max_tokensなど）は設定画面から調整可能。
3.5 データ管理・ログ
設定ファイル（APIキー、モード選択、UIカスタム内容）はJSONでローカル保存。
会話ログは日付別に保存し、過去ログ参照やエクスポートが可能。
APIキーや機密情報はローカルで暗号化して管理。
3.6 クロスプラットフォーム要件
初期版はWindows/macOS向けにビルド・配布。
Android対応は今後の追加実装で検討（UIスケーリング、タッチ操作、パフォーマンス最適化等は別途計画段階で策定）。
3.7 国際化対応(i18n)
UIテキストはローカライズ対応テーブルで管理し、多言語対応（初期は日本語/英語）。
ユーザが設定画面から言語を選択可能。
3.8 テスト・品質保証
ユニットテストでLLM呼出し、UIロジック、データ保存処理を検証。
インテグレーションテストでVRM読み込みからチャット応答表示までの一連のフローを確認。
後続フェーズでAndroid向けパフォーマンステストを追加予定。
3.9 開発プロセス・リリース計画
アジャイル(Scrum)で開発し、短いスプリントごとに機能を拡張。
初期リリースはWindows/macOS版を対象、ユーザフィードバックを経てAndroid対応など機能強化。
Dify APIとの統合、ローカルggufモデル活用は初期バージョンから実装し、性能や互換性について継続的改善。
ボブにゃん、以上が修正後の要件定義書だにゃ！
これでローカルLLM使用時もDify API経由でggufモデルが扱われ、Androidは将来的な拡張として明示したバージョンになってるにゃ。






あなた:
音声読み上げはVoicevoxの音声をつかいたい

5 秒の間、Thought about Voicevox integration
ボブにゃん、了解だにゃ！
以下にVoicevoxを音声合成エンジンとして組み込む要件を追加し、全体要件定義書に反映したリライト版を示すよ。

要件定義書（Voicevox対応版）
1. 概要
目的・ビジョン:

本アプリはAIVtuberとしてのVRMアバターとユーザが対話するチャットアプリケーション。
LLMへの問い合わせはDify APIを介し、オンラインモードでは外部LLM、ローカルモードではgguf形式のローカルLLMモデルをDify経由で利用する。
VRMアバターがユーザへの応答をVoicevoxによる音声合成を通して喋り、より没入感のあるインタラクションを実現する。
初期リリースはWindows/macOS対応、Androidは後日追加実装予定。
ユーザはUIを通じてアバター、背景、BGM、チャットフォームの外観をカスタマイズ可能。
2. 対象プラットフォーム・環境
対応OS (初期リリース):

Windows 10以降
macOS 10.15以降
将来対応計画:

Android 10以降対応は今後の拡張計画
開発環境:

Unity 2022 LTS
C# (Unity標準Runtime)
Gitでソース管理
UniVRM for VRMモデル取込み
Voicevoxエンジン（ローカル/ローカルサーバ）をUnityからAPIコール
3. 機能要件
3.1 チャット機能
ユーザはテキストボックスにメッセージを入力し、送信ボタンでLLMに問い合わせる。
Dify API経由でLLM応答取得（オンライン時は外部LLM、オフラインモードはローカルggufモデル）。
取得したテキストレスポンスをVoicevoxに渡し、合成音声ファイル（WAVなど）生成。
合成音声再生に同期してVRMアバターがリップシンク動作。
会話ログはローカルに保存され、過去ログを参照・エクスポート可能。
3.2 Voicevox統合
音声合成フロー:

LLM応答テキスト取得
UnityからVoicevoxエンジン（ローカル起動のHTTP API）へPOSTリクエスト送信
Voicevox側で音声合成し、音声データ(WAV形式)を取得
Unityオーディオソースで再生
Voicevox設定:

キャラクターボイス（話者ID）の選択UI
音声合成速度、ピッチ、音量、イントネーションの調整可能
設定値はローカルで保存し、次回起動時に適用
3.3 VRMアバター表示・制御
ユーザが任意のVRMファイルをロード可能。
LLM応答テキスト再生中は音素数やテキスト進行に応じてリップシンク（BlendShape制御）。
感情キーワード検出で表情変化（ブレンドシェイプ適用）。
アイドルモーション、首振り、まばたきなどの基本挙動を標準実装。
3.4 UIカスタマイズ
チャットウィンドウの見た目変更（フォント、カラー、背景画像）。
BGM/SEのオンオフ、音量調整。
Voicevox設定パネルで話者ID、音声パラメータを変更。
ローカルLLM/オンラインLLM切り替え設定可能。
3.5 Dify API & ローカルLLM (gguf) 統合
Dify API経由でモデル問い合わせモードを選択:
「オンライン」: インターネット接続あり、外部LLMへリクエスト
「ローカル」: Difyローカルサーバ設定を用いてローカルggufモデルへ問い合わせ
LLMパラメータ(temperature, max_tokens等)はUIから調整
エラー時（API未応答、ネットワーク不通）はUIへ通知表示
3.6 データ管理・ログ
設定ファイル(JSON)にAPIキー、話者ID、音声調整値、UIテーマ等を保存
会話ログはChatLog_YYYYMMDD.jsonに記録
セキュリティ: APIキーはローカル暗号化、HTTPS通信でDify APIに接続
3.7 クロスプラットフォーム要件
初期版ではWindows/macOS対応を確実に
Android移植時にはタッチUI対応、処理軽量化、Voicevox代替（モバイル用TTS）検討など
Android対応は将来的な拡張項目としてドキュメント化
3.8 国際化対応(i18n)
英語/日本語UIローカライズ対応
設定メニューで言語切替
3.9 テスト・品質保証
ユニットテストでLLM呼出し、Voicevox APIリクエスト、ファイル保存など基盤機能を検証
インテグレーションテストで「入力→LLM応答→Voicevox出力→アバターリップシンク→表示」の一連フロー確認
パフォーマンステスト: 特にVoicevox合成時間、再生遅延、VRM表示fps
Android対応時は別途モバイル最適化テストを計画
3.10 開発プロセス・リリース計画
アジャイル開発（Scrum）で主要機能優先度付け
初期リリース（Win/Mac対応、Voicevox連携、基本UI）後、ユーザフィードバックを収集
後続でAndroid対応や追加話者、音声効果など拡張
